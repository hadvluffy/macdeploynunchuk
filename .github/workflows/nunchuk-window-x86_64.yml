name: nunchuk-window-x86_64

on:
  push:
    tags:
    - '*'
  workflow_dispatch:
  
jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        
      - name: Check Windows Version
        shell: pwsh
        run: systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

      - name: Setup msbuild
        uses: microsoft/setup-msbuild@v2
        with:
            msbuild-architecture: x64

      - name: Setup CMake
        uses: lukka/get-cmake@latest

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install aqtinstall
        run: |
          pip install aqtinstall
  
      - name: Install Qt 5.15.2 (MSVC 2019)
        run: |
          aqt install-qt windows desktop 5.15.2 win64_msvc2019_64 --archives -m qtcharts qtwebengine
  
      - name: Print Qt installation path
        run: |
          $qtPath = "C:\Users\runneradmin\aqt\windows\desktop\5.15.2\msvc2019_64"
          echo "Qt installed at: $qtPath"
          dir $qtPath
          echo "Listing Qt bin:"
          dir "$qtPath\bin"
  
      - name: Set Qt env
        run: |
          echo "QT_DIR=C:\Users\runneradmin\aqt\windows\desktop\5.15.2\msvc2019_64" >> $GITHUB_ENV
